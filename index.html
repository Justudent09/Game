<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram CloudStorage Example</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        input, button {
            margin: 5px;
            padding: 8px;
        }
    </style>
</head>
<body>
    <h1>Telegram CloudStorage API Example</h1>
    <div>
        <h3>Сохранить элемент</h3>
        <input type="text" id="saveKey" placeholder="Введите ключ">
        <input type="text" id="saveValue" placeholder="Введите значение">
        <button onclick="saveItem()">Сохранить</button>
    </div>

    <div>
        <h3>Получить элемент</h3>
        <input type="text" id="getKey" placeholder="Введите ключ">
        <button onclick="getItem()">Получить</button>
        <p id="getResult"></p>
    </div>

    <div>
        <h3>Удалить элемент</h3>
        <input type="text" id="deleteKey" placeholder="Введите ключ">
        <button onclick="deleteItem()">Удалить</button>
    </div>

    <div>
        <h3>Получить все ключи</h3>
        <button onclick="getAllKeys()">Получить ключи</button>
        <p id="keysResult"></p>
    </div>

    <script>
        // Проверяем, доступен ли Web App API
        if (window.Telegram && Telegram.WebApp) {
            Telegram.WebApp.ready();
        } else {
            alert('Telegram WebApp API не доступен');
        }

        // Сохранение элемента
        function saveItem() {
            const key = document.getElementById('saveKey').value;
            const value = document.getElementById('saveValue').value;

            Telegram.WebApp.CloudStorage.setItem(key, value, (error, success) => {
                if (error) {
                    Telegram.WebApp.showAlert('Ошибка сохранения: ' + error);
                } else {
                    Telegram.WebApp.showAlert('Элемент успешно сохранён');
                }
            });
        }

        // Получение элемента
        function getItem() {
            const key = document.getElementById('getKey').value;

            Telegram.WebApp.CloudStorage.getItem(key, (error, value) => {
                if (error) {
                    Telegram.WebApp.showAlert('Ошибка: ' + error);
                } else {
                    document.getElementById('getResult').innerText = 'Значение: ' + value;
                    Telegram.WebApp.showAlert('Значение: ' + value);
                }
            });
        }

        // Удаление элемента
        function deleteItem() {
            const key = document.getElementById('deleteKey').value;

            Telegram.WebApp.CloudStorage.removeItem(key, (error, success) => {
                if (error) {
                    Telegram.WebApp.showAlert('Ошибка удаления: ' + error);
                } else {
                    Telegram.WebApp.showAlert('Элемент успешно удалён');
                }
            });
        }

        // Получение всех ключей
        function getAllKeys() {
            Telegram.WebApp.CloudStorage.getKeys((error, keys) => {
                if (error) {
                    Telegram.WebApp.showAlert('Ошибка: ' + error);
                } else {
                    const keysText = keys.join(', ');
                    document.getElementById('keysResult').innerText = 'Ключи: ' + keysText;
                    Telegram.WebApp.showAlert('Ключи: ' + keysText);
                }
            });
        }
    </script>
</body>
</html>