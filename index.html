function checkWinner() {
            const winPatterns = [
                [0, 1, 2],
                [3, 4, 5],
                [6, 7, 8],
                [0, 3, 6],
                [1, 4, 7],
                [2, 5, 8],
                [0, 4, 8],
                [2, 4, 6]
            ];

            return winPatterns.some(pattern => {
                const [a, b, c] = pattern;
                return boardState[a] && boardState[a] === boardState[b] && boardState[a] === boardState[c];
            });
        }

        function showEndGameModal(message) {
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;

                gameActive = false;

                tg.showPopup({
                    title: 'Игра окончена',
                    message: message,
                    buttons: [
                        { id: 'restart', type: 'default', text: 'Начать заново' }
                    ]
                }, (buttonId) => {
                    if (buttonId === 'restart') {
                        resetGame();
                    }
                });
                tg.onEvent('popupClosed', () => {
                    resetGame();
                });
            } else {
                resetGame();
            }
        }

        function resetGame() {
            boardState = Array(9).fill(null);
            currentPlayer = '❌';
            gameActive = true;
            createBoard();
        }

        createBoard();
    </script>
</body>
</html>